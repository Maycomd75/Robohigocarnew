<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hiago Car - Assistente Virtual</title>
<style>
  body { font-family: Arial, sans-serif; background: #111; margin: 0; padding: 0; }
  .chat-container { max-width: 600px; margin: auto; padding: 20px; }
  .chat-box { background: #000; border-radius: 10px; padding: 15px; height: 500px; overflow-y: auto; }
  .message { margin: 10px 0; padding: 10px; border-radius: 8px; max-width: 80%; }
  .bot { background: #2ecc71; color: #fff; align-self: flex-start; }
  .user { background: #3498db; color: #fff; align-self: flex-end; text-align: right; }
  .input-container { display: flex; margin-top: 10px; }
  input { flex: 1; padding: 10px; border: none; border-radius: 5px; }
  button { padding: 10px; border: none; background: #2ecc71; color: white; border-radius: 5px; margin-left: 5px; cursor: pointer; }
</style>
</head>
<body>
<div class="chat-container">
  <h2 style="color:white; text-align:center;">‚öôÔ∏è Hiago Car - Assistente Virtual</h2>
  <div class="chat-box" id="chatBox"></div>
  <div class="input-container">
    <input type="text" id="userInput" placeholder="Digite sua mensagem...">
    <button onclick="sendMessage()">Enviar</button>
  </div>
</div>

<script>
  const chatBox = document.getElementById("chatBox");
  let cliente = { nome: "", placa: "", modelo: "", data: "", hora: "", servicos: [] };

  function addMessage(text, sender = "bot") {
    const div = document.createElement("div");
    div.classList.add("message", sender);
    div.innerHTML = text.replace(/\n/g, "<br>");
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  function sendMessage() {
    const input = document.getElementById("userInput");
    const text = input.value.trim();
    if (!text) return;
    addMessage(text, "user");
    processMessage(text);
    input.value = "";
  }

  function processMessage(msg) {
    if (!cliente.nome) {
      cliente.nome = msg;
      addMessage("Informe a placa do ve√≠culo:");
    } else if (!cliente.placa) {
      cliente.placa = msg;
      addMessage("Informe o modelo do ve√≠culo:");
    } else if (!cliente.modelo) {
      cliente.modelo = msg;
      cliente.data = new Date().toISOString().split("T")[0];
      addMessage("Escolha um hor√°rio dispon√≠vel para " + cliente.data + ":");
    } else if (!cliente.hora) {
      cliente.hora = msg;
      addMessage("‚è≥ Enviando seu agendamento...");
      salvarNoSheets(cliente).then(() => {
        addMessage(`‚úÖ Agendamento conclu√≠do!\n\nüìã Nome: ${cliente.nome}\nüöò Placa: ${cliente.placa}\nüîß Modelo: ${cliente.modelo}\nüìÖ Data: ${cliente.data}\n‚è∞ Hor√°rio: ${cliente.hora}`);
      });
    }
  }

  function salvarNoSheets(cliente) {  
    return fetch("https://script.google.com/macros/s/AKfycbz2cSZiH_Tvzlpi7EWXiaVmIfdhmHs2mMzATYo29GJu59EgWntvyDCuj8Hlbk2upkex/exec", {  
      method: "POST",  
      body: JSON.stringify({  
        nome: cliente.nome,  
        placa: cliente.placa,  
        modelo: cliente.modelo,  
        data: cliente.data,  
        hora: cliente.hora,  
        servicos: cliente.servicos.map(s => s.nome || s).join(", ")  
      }),  
      headers: { "Content-Type": "application/json" }  
    })  
    .then(res => {  
      if (!res.ok) throw new Error(`Erro HTTP: ${res.status}`);  
      return res.json();  
    })  
    .then(data => {  
      addMessage("‚úÖ Dados enviados com sucesso para o Google Sheets.", "bot");  
      return data;  
    })  
    .catch(err => {  
      addMessage("‚ùå Falha ao enviar: " + err.message, "bot");  
      console.error("Erro ao enviar:", err);  
    });  
  }
</script>
</body>
</html>
